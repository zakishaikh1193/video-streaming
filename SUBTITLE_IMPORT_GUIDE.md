# Subtitle Import Guide

## Problem

Subtitle files generated by the batch script are saved to `backend/subtitles/`, but the video player system expects captions to be:
1. In `video-storage/captions/` directory
2. Named as `${videoId}_${language}.vtt` (e.g., `VID_4VFYDM03BP_en.vtt`)
3. Added to the `captions` database table

## Solution

Use the import script to migrate subtitle files to the caption system.

## Steps

### 1. Generate Subtitles (if not done already)

```bash
cd backend
npm run generate-all-subtitles
```

This creates `.vtt` files in `backend/subtitles/`.

### 2. Import Subtitles to Caption System

```bash
cd backend
npm run import-subtitles
```

This will:
- Scan `backend/subtitles/` for `.vtt` files
- Copy them to `video-storage/captions/` with correct naming
- Add database entries in the `captions` table
- Only import subtitles for videos that exist in the database

### 3. Options

**Dry run (see what would be done without making changes):**
```bash
npm run import-subtitles -- --dry-run
```

**Specify language (default is 'en'):**
```bash
npm run import-subtitles -- --language es
```

**Combined:**
```bash
npm run import-subtitles -- --language en --dry-run
```

## Verification

After importing, verify:

1. **Files exist in correct location:**
   ```bash
   ls video-storage/captions/VID_4VFYDM03BP_en.vtt
   ```

2. **Database entry exists:**
   ```sql
   SELECT * FROM captions WHERE video_id = 'VID_4VFYDM03BP';
   ```

3. **Test in video player:**
   - Open a video page
   - Check if CC button appears
   - Click CC button and verify subtitles display

## Troubleshooting

### "Video not found in database"
- The subtitle file name must match a `video_id` in the `videos` table
- Check: `SELECT video_id FROM videos WHERE video_id = 'VID_4VFYDM03BP';`

### "Caption already exists"
- The script skips videos that already have captions for that language
- To re-import, delete the existing caption entry first:
  ```sql
  DELETE FROM captions WHERE video_id = 'VID_4VFYDM03BP' AND language = 'en';
  ```

### CC button not showing
- Check browser console for errors
- Verify caption URL is accessible: `http://localhost:5000/video-storage/captions/VID_4VFYDM03BP_en.vtt`
- Check that `getVideo` endpoint includes captions in response
- See `SUBTITLE_DEBUG_GUIDE.md` for detailed debugging steps

## File Structure

**Before import:**
```
backend/
└── subtitles/
    └── VID_4VFYDM03BP.vtt
```

**After import:**
```
video-storage/
└── captions/
    └── VID_4VFYDM03BP_en.vtt  (renamed with language suffix)
```

**Database:**
```sql
captions table:
- video_id: 'VID_4VFYDM03BP'
- language: 'en'
- file_path: 'captions/VID_4VFYDM03BP_en.vtt'
```
